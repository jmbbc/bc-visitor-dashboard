<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dashboard Keselamatan ‚Äî Banjaria Court</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* Local dashboard tweaks */
    .dashboard-wrap { display:flex; flex-direction:column; gap:12px; }

    .head-shell { padding:12px; border-radius:10px; background:var(--card); box-shadow:0 1px 3px rgba(0,0,0,0.06); border:1px solid var(--input-border); }
    .head-row { display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .today-pill { display:flex; flex-direction:column; gap:4px; }
    .head-grid { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:12px; align-items:stretch; margin-top:10px; }
    @media (max-width: 900px) { .head-grid { grid-template-columns: 1fr; } }
    .top-nav { display:flex; flex-direction:column; gap:10px; height:320px; max-height:320px; overflow:hidden; }
    .top-nav nav { display:flex; flex-direction:column; gap:10px; }
    .top-nav .nav-group { display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:8px; padding:8px; border-radius:10px; background: linear-gradient(180deg, rgba(0,0,0,0.01), transparent); align-items:stretch; }
    /* Make all nav shortcut boxes uniform size */
    .nav-item { text-align:left; padding:8px 10px; border-radius:8px; border:1px solid var(--input-border); background:var(--surface); cursor:pointer; color:var(--text-900); font-weight:600; transition: background .12s, color .12s; font-size:14px; display:flex; align-items:center; gap:10px; min-height:56px; box-sizing:border-box; }
    .nav-item .nav-icon { font-size:18px; line-height:1; display:inline-flex; width:20px; justify-content:center; }
    .nav-item .nav-label { display:block; font-size:14px; white-space:normal; line-height:1.15; word-break:break-word; }
    .nav-item.active { background: rgba(37,99,235,0.08); color: var(--text-900); border-color: transparent; }
    .nav-item.active:hover { background: rgba(37,99,235,0.10); }
    .nav-item:active { transform: translateY(1px); }

    /* Selected / focused box visual (black 1px outer outline) ‚Äî used for the main nav boxes */
    .nav-item.selected { box-shadow: 0 0 0 1px #000000; }
    /* Visible focus ring for keyboard users ‚Äî matches the selected appearance but uses an accessible outline offset */
    .nav-item:focus-visible { outline: 2px solid #000000; outline-offset: 2px; }

    /* Distinct colours for the four primary buttons */
    /* Summary (teal/green) - changed to solid soft-teal background */
    /* stronger override to avoid being masked by other site CSS */
    .nav-group button#navSummary.nav-item { background: linear-gradient(180deg, rgba(6,182,212,0.14), rgba(6,182,212,0.12)) !important; border-color: rgba(6,182,212,0.18) !important; color: #042f2a !important; }
    #navSummary.active { background: linear-gradient(180deg, rgba(6,182,212,0.22), rgba(6,182,212,0.18)); color: #042f2a; border-color: transparent; box-shadow: 0 2px 6px rgba(6,182,212,0.12); }
    #navSummary:hover { background: linear-gradient(180deg, rgba(6,182,212,0.18), rgba(6,182,212,0.14)); }

    /* Checked-in (indigo/violet) ‚Äî stronger indigo background */
    .nav-group button#navCheckedIn.nav-item { background: linear-gradient(180deg, rgba(79,70,229,0.12), rgba(79,70,229,0.10)) !important; border-color: rgba(79,70,229,0.18) !important; color: #111827 !important; }
    #navCheckedIn.active { background: linear-gradient(180deg, rgba(79,70,229,0.18), rgba(79,70,229,0.14)); color: #0f172a; border-color: transparent; box-shadow: 0 2px 6px rgba(79,70,229,0.12); }
    #navCheckedIn:hover { background: linear-gradient(180deg, rgba(79,70,229,0.14), rgba(79,70,229,0.10)); }

    /* Parking (amber/orange) ‚Äî warm amber background */
    .nav-group button#navParking.nav-item { background: linear-gradient(180deg, rgba(250,190,50,0.14), rgba(250,190,50,0.10)) !important; border-color: rgba(250,190,50,0.16) !important; color: #2b1808 !important; }
    #navParking.active { background: linear-gradient(180deg, rgba(250,190,50,0.22), rgba(250,190,50,0.16)); color: #2b1808; border-color: transparent; box-shadow: 0 2px 6px rgba(250,190,50,0.12); }
    #navParking:hover { background: linear-gradient(180deg, rgba(250,190,50,0.18), rgba(250,190,50,0.12)); }

    /* Unit Admin (indigo/violet) ‚Äî match page heading color */
    .nav-group button#navUnitAdmin.nav-item { background: linear-gradient(180deg, rgba(99,102,241,0.12), rgba(99,102,241,0.10)) !important; border-color: rgba(99,102,241,0.18) !important; color: #0f172a !important; }
    #navUnitAdmin.active { background: linear-gradient(180deg, rgba(99,102,241,0.18), rgba(99,102,241,0.14)); color: #0f172a; border-color: transparent; box-shadow: 0 2px 6px rgba(99,102,241,0.12); }
    #navUnitAdmin:hover { background: linear-gradient(180deg, rgba(99,102,241,0.14), rgba(99,102,241,0.10)); }

    /* Water readings (blue) */
    .nav-group button#navWater.nav-item { background: linear-gradient(180deg, rgba(59,130,246,0.12), rgba(59,130,246,0.10)) !important; border-color: rgba(59,130,246,0.18) !important; color: #0f172a !important; }
    #navWater.active { background: linear-gradient(180deg, rgba(59,130,246,0.18), rgba(59,130,246,0.14)); color: #0f172a; border-color: transparent; box-shadow: 0 2px 6px rgba(59,130,246,0.12); }
    #navWater:hover { background: linear-gradient(180deg, rgba(59,130,246,0.14), rgba(59,130,246,0.10)); }

    /* Export CSV (green) */
    .nav-group button#exportAllCSVBtn.nav-item { background: linear-gradient(180deg, rgba(34,197,94,0.12), rgba(34,197,94,0.10)) !important; border-color: rgba(34,197,94,0.18) !important; color: #065f46 !important; }
    #exportAllCSVBtn.active { background: linear-gradient(180deg, rgba(34,197,94,0.18), rgba(34,197,94,0.14)); color: #065f46; border-color: transparent; box-shadow: 0 2px 6px rgba(34,197,94,0.12); }
    #exportAllCSVBtn:hover { background: linear-gradient(180deg, rgba(34,197,94,0.14), rgba(34,197,94,0.10)); }

    /* Action button shortcuts ‚Äî uniform themed look */
    /* Check In (primary) */
    .actions button[data-action="in"] { background: linear-gradient(180deg, rgba(34,197,94,0.12), rgba(34,197,94,0.10)) !important; border-color: rgba(34,197,94,0.18) !important; color: #065f46 !important; }
    .actions button[data-action="in"]:hover { background: linear-gradient(180deg, rgba(34,197,94,0.14), rgba(34,197,94,0.12)); }

    /* Check Out (secondary/caution) */
    .actions button[data-action="out"], .actions button.btn-ghost[data-action="out"] { background: linear-gradient(180deg, rgba(250,190,50,0.10), rgba(250,190,50,0.06)) !important; border-color: rgba(250,190,50,0.12) !important; color: #2b1808 !important; }
    .actions button[data-action="out"]:hover { background: linear-gradient(180deg, rgba(250,190,50,0.12), rgba(250,190,50,0.08)); }

    /* Primary action buttons (consistent green theme) */
    #passdownSaveBtn, #parkingSaveAll, #waterSaveBtn, #csvImportBtn, #csvForceWriteBtn, #migrateApplyBtn, #saveUnitBtn, #adminModalLoginBtn, #confirmModalConfirm, #adminOpenLoginBtn, #unitAddBtn {
      background: linear-gradient(180deg, rgba(34,197,94,0.12), rgba(34,197,94,0.10)) !important; border-color: rgba(34,197,94,0.18) !important; color: #065f46 !important;
    }
    #passdownSaveBtn:hover, #parkingSaveAll:hover, #waterSaveBtn:hover, #csvImportBtn:hover, #csvForceWriteBtn:hover, #migrateApplyBtn:hover, #saveUnitBtn:hover, #adminModalLoginBtn:hover, #confirmModalConfirm:hover, #adminOpenLoginBtn:hover, #unitAddBtn:hover {
      background: linear-gradient(180deg, rgba(34,197,94,0.14), rgba(34,197,94,0.12));
    }

    /* Secondary / ghost-like actions (subtle teal tint) */
    #passdownClearBtn, #cancelUnitBtn, #csvPreviewBtn, #migratePreviewBtn, #adminLogoutBtn, #adminModalCancelBtn, #confirmModalCancel, #csvFileLabel {
      background: linear-gradient(180deg, rgba(6,182,212,0.06), rgba(6,182,212,0.03)) !important; border-color: rgba(6,182,212,0.10) !important; color: #042f2a !important;
    }
    #passdownClearBtn:hover, #cancelUnitBtn:hover, #csvPreviewBtn:hover, #migratePreviewBtn:hover, #adminLogoutBtn:hover, #adminModalCancelBtn:hover, #confirmModalCancel:hover, #csvFileLabel:hover {
      background: linear-gradient(180deg, rgba(6,182,212,0.08), rgba(6,182,212,0.04));
    }

    .top-info { display:flex; justify-content:space-between; gap:12px; align-items:center; margin-bottom:12px; flex-wrap:wrap; }
    .kpi { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .kpi .chip { background:var(--card); border:1px solid var(--input-border); padding:8px 10px; border-radius:8px; font-weight:700; }

    .table { width:100%; border-collapse:collapse; font-size:14px; }
    .table th, .table td { padding:8px; border-bottom:1px solid var(--input-border); text-align:left; vertical-align:middle; }
    .table td .small { display:block; color:var(--muted); margin-top:6px; font-size:10px; }

    .actions { display:flex; gap:8px; align-items:center; }
    .actions button { min-width:96px; padding:8px 10px; border-radius:8px; }

    tr.conflict td { background: rgba(255,243,205,0.6); }

    .tel-link { color: var(--accent); font-weight:600; text-decoration: none; }
    .tel-link:hover { text-decoration: underline; }

    .table-wrap { overflow-x:auto; }

    /* Admin controls row tweaks */
    .admin-controls-row input[type="text"], .admin-controls-row input[type="search"], .admin-controls-row input[type="date"], .admin-controls-row input[type="number"] { min-height:36px; padding:8px 10px; border-radius:8px; border:1px solid var(--input-border); }
    .admin-controls-row .btn, .admin-controls-row .btn-ghost { min-height:36px; padding:8px 12px; }
    .csv-controls .file-input-label { font-weight:600; }

    @media (max-width: 640px) {
      .login-box { margin:8px 0; }
      .actions button { min-width:72px; padding:8px 6px; }
      .admin-controls-row { gap:6px; }
    }

    /* Modal base (kept minimal; additional styles in css/style.css) */
    .modal.hidden { display:none !important; }

    /* Page-level boxed headings (matches nav colors) */
    /* Make heading box take full width and match approx 34.4px height while remaining responsive */
    .page-heading-box {
      display:flex; /* center content both vertically + horizontally */
      align-items:center;
      justify-content:center;
      text-align:center;
      width:100%;
      box-sizing:border-box;
      padding:0 16px; /* horizontal padding only to keep vertical centering exact */
      height:34.4px; /* target visual height */
      border-radius:10px;
      font-weight:700;
      margin-bottom:12px;
      color: #07202b;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.04);
    }
    #pageSummary > h3.page-heading-box { background: linear-gradient(180deg, rgba(6,182,212,0.12), rgba(6,182,212,0.08)); border: 1px solid rgba(6,182,212,0.14); color: #042f2a; }
    #pageCheckedIn > h3.page-heading-box { background: linear-gradient(180deg, rgba(79,70,229,0.12), rgba(79,70,229,0.08)); border: 1px solid rgba(79,70,229,0.14); color: #07102a; }
    #pageParking > h3.page-heading-box { background: linear-gradient(180deg, rgba(250,190,50,0.12), rgba(250,190,50,0.08)); border: 1px solid rgba(250,190,50,0.14); color: #2b1808; }
    /* Unit Admin page heading ‚Äî match other page heading styles (indigo/violet) */
    #pageUnitAdmin > h3.page-heading-box { background: linear-gradient(180deg, rgba(99,102,241,0.12), rgba(99,102,241,0.08)); border: 1px solid rgba(99,102,241,0.14); color: #0f172a; }
    /* On small screens, reduce height/padding so text wraps nicely */
    @media (max-width: 480px) {
      .page-heading-box { height: auto; padding:10px 12px; text-align:center; justify-content:center; align-items:center; }
    }

    /* Passdown / mini note pad (now under head) */
    .passdown-card { margin-top:0; padding:12px; border-radius:10px; background:var(--surface); border:1px solid var(--input-border); box-shadow:0 1px 3px rgba(0,0,0,0.05); }
    .passdown-card textarea { width:100%; min-height:88px; resize:vertical; border-radius:10px; border:1px solid var(--input-border); padding:10px 12px; background:var(--card); }
    .passdown-actions { display:flex; gap:6px; margin-top:6px; }
    .passdown-actions button { flex:1; min-height:38px; padding:8px 10px; }
    .passdown-list-box { display:flex; flex-direction:column; gap:8px; height:320px; max-height:320px; overflow:hidden; }
    .passdown-list { flex:1; min-height:0; display:flex; flex-direction:column; gap:6px; overflow-y:auto; overflow-x:hidden; border:1px solid var(--input-border); border-radius:10px; padding:8px; background:var(--card); }
    .passdown-item { position:relative; display:flex; gap:10px; align-items:flex-start; padding:10px 12px; border-radius:8px; background:linear-gradient(180deg, rgba(6,182,212,0.06), rgba(6,182,212,0.04)); border:1px solid var(--input-border); }
    .passdown-body { flex:1; min-width:0; }
    .passdown-item-text { font-size:13px; font-weight:600; color:var(--text-900); word-break:break-word; }
    .passdown-meta { margin-top:4px; font-size:11px; color:var(--muted); display:flex; gap:6px; align-items:center; flex-wrap:wrap; }
    .passdown-pencil { position:absolute; top:6px; right:8px; border:1px solid var(--input-border); border-radius:6px; padding:4px 6px; background:var(--surface); cursor:pointer; font-size:12px; line-height:1; color:var(--text-900); }
    .passdown-actions-inline { position:absolute; top:32px; right:8px; display:none; gap:6px; background:var(--card); border:1px solid var(--input-border); border-radius:8px; padding:6px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
    .passdown-actions-inline.open { display:flex; }
    .passdown-actions-inline button { padding:6px 10px; min-height:32px; font-size:12px; }
  </style>
</head>
<body>
  <main class="container" style="padding:18px 12px;">
    <a href="index.html" class="small">‚Üê Kembali</a>
    <h2 style="margin-top:8px">Dashboard Keselamatan</h2>

    <div id="loginBox" class="login-box card small" style="max-width:420px;margin-top:12px">
      <label>Email</label>
      <input id="loginEmail" type="email" />
      <label>Password</label>
      <input id="loginPass" type="password" />
      <div class="row" style="margin-top:8px">
        <button id="loginBtn">Log Masuk</button>
        <button id="logoutBtn" style="display:none" class="btn-ghost">Log Keluar</button>
      </div>
      <div id="loginMsg" role="status" aria-live="polite" class="small" style="margin-top:8px"></div>
    </div>

    <div id="dashboardArea" style="display:none; margin-top:12px">
      <div class="dashboard-wrap">
        <!-- Head (was sidebar) -->
        <div class="head-shell" aria-label="Navigasi Dashboard">
          <div class="head-row">
            <div class="today-pill">
              <div class="small muted">Tarikh hari ini</div>
              <div id="todayLabel" style="font-weight:800;font-size:16px;margin-top:2px"></div>
              <div id="todayTime" class="muted-small"></div>
            </div>
          </div>

          <div class="head-grid">
            <div class="top-nav">
              <nav>
                <div class="nav-group primary">
                  <button id="navSummary" class="nav-item active"><span class="nav-icon">üìã</span><span class="nav-label">Senarai pendaftaran</span></button>
                  <button id="navCheckedIn" class="nav-item"><span class="nav-icon">‚úÖ</span><span class="nav-label">Pelawat Checked In (Hari Ini)</span></button>
                  <button id="navParking" class="nav-item"><span class="nav-icon">üöó</span><span class="nav-label">Laporan Parkir Pelawat</span></button>
                  <button id="navUnitAdmin" class="nav-item"><span class="nav-icon">üßæ</span><span class="nav-label">Kemas Kini Unit (CSV)</span></button> 
                  <button id="navWater" class="nav-item"><span class="nav-icon">üíß</span><span class="nav-label">Bacaan Air</span></button>
                  <button id="exportAllCSVBtn" class="nav-item"><span class="nav-icon">‚¨áÔ∏è</span><span class="nav-label">Eksport CSV (Semua)</span></button>
                </div>
              </nav>

              <div class="passdown-card" aria-label="Nota bertugas">
                <div class="small muted">Nota Bertugas (shif seterusnya)</div>
                <textarea id="passdownInput" placeholder="Catat nota pantas untuk passdown..." aria-label="Nota bertugas"></textarea>
                <div class="passdown-actions">
                  <button id="passdownSaveBtn" type="button">Simpan</button>
                  <button id="passdownClearBtn" type="button" class="btn-ghost">Kosongkan</button>
                </div>
              </div>
            </div>

            <div class="passdown-card passdown-list-box" aria-label="Senarai nota bertugas">
              <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
                <div class="small muted">Senarai nota</div>
                <div id="passdownMeta" class="muted-small"></div>
              </div>
              <div class="muted-small" style="margin-top:4px;">Nota terbaru di atas. Klik pensel untuk edit atau padam.</div>
              <div id="passdownList" class="passdown-list small" aria-live="polite"></div>
            </div>
          </div>
        </div>

        <!-- Main -->
        <section>
          <div class="top-info">
            <div>
              <div class="small">Log masuk sebagai: <strong id="who"></strong></div>
              <div id="kpiWrap" style="margin-top:8px" class="kpi"></div>
            </div>

            <!-- Per-page date filters: summary, checked-in and parking each have their own date input -->
            <div id="dateFiltersWrap" style="display:flex;gap:8px;align-items:center">
              <div id="summaryDateWrap" style="display:flex;align-items:center;gap:8px">
                <label for="filterDateSummary" class="small muted">Tunjuk mengikut ETA</label>
                <input id="filterDateSummary" type="date" />
              </div>
              <div id="checkedInDateWrap" style="display:none;align-items:center;gap:8px">
                <label for="filterDateCheckedIn" class="small muted">Tunjuk Checked In</label>
                <input id="filterDateCheckedIn" type="date" />
              </div>
              <!-- parking page uses the weekly navigator; no date input here -->
            </div>
          </div>

          <!-- injected controls (overlap) -->
          <div id="injectedControls"></div>

          <!-- Pages -->
          <div id="pageSummary">
            <div id="summarySearchWrap" style="margin-top:6px; margin-bottom:6px; display:flex; justify-content:flex-end;">
              <input id="summarySearch" type="search" placeholder="Cari nama / unit / telefon / kenderaan / kategori" style="min-width:260px; padding:8px 10px; border-radius:10px; border:1px solid var(--input-border);" aria-label="Cari senarai pendaftaran" />
            </div>
            <h3 class="page-heading-box" style="margin-top:6px">Senarai pendaftaran</h3>
            <div id="listAreaSummary" style="margin-top:8px"></div>
          </div>

          <div id="pageCheckedIn" style="display:none">
            <h3 class="page-heading-box" style="margin-top:6px">Pelawat Checked In ‚Äî Hari Ini</h3>
            <div id="listAreaCheckedIn" style="margin-top:8px"></div>
          </div>

          <!-- Halaman Parkir: dua kolum, kad selari -->
          <div id="pageParking" style="display:none; margin-top:12px;">
            <h3 class="page-heading-box" style="margin-top:6px">Laporan Parkir Pelawat</h3>
            <div style="margin:6px 0; display:flex; justify-content:flex-end;">
              <input id="parkingSearch" type="search" placeholder="Cari nombor plat / unit" style="min-width:240px; padding:8px 10px; border-radius:10px; border:1px solid var(--input-border);" aria-label="Cari laporan parkir" />
            </div>
            <div class="card card-tight">
              <h4 style="margin-top:0">Ringkasan & kawalan</h4>

              <div class="parking-header">
                <div class="ph-item">
                  <div class="small muted">Tarikh</div>
                  <div id="parkingDateLabel" class="ph-value"></div>
                </div>
                <div class="ph-item">
                  <div class="small muted">Waktu</div>
                  <div class="ph-value">12:00 am</div>
                </div>
                <div class="ph-item ph-grow">
                  <label for="parkingPKName" class="small muted">Nama PK</label>
                  <input id="parkingPKName" placeholder="Nama PK" />
                </div>
                <div class="ph-item">
                  <button id="parkingSaveAll" class="btn">Simpan Semua</button>
                </div>
              </div>

              <!-- Admin page moved out to dedicated 'Kemas Kini Unit' page (see nav Kemas Kini Unit) -->

              <!-- parking grid removed per request: Masuk / Luar lot blocks omitted -->
              <div id="parkingListArea" style="display:none; margin-top:8px"></div>
            </div>
          </div>

          <!-- Main Unit Admin page (CSV / Manual) -->
          <div id="pageUnitAdmin" style="display:none; margin-top:12px;">
            <h3 class="page-heading-box" style="margin-top:6px">Kemas Kini Unit ‚Äî (CSV / Manual)</h3>
            <div class="card card-tight" style="max-width:920px;">
              <div style="max-width:920px;margin:6px auto;padding:6px;text-align:left;display:flex;align-items:center;gap:12px;">
                <div style="flex:1">
                  <div style="font-weight:700">Kemas Kini Unit</div>
                  <div class="small muted">Gunakan halaman ini untuk import CSV atau mengemaskini unit secara manual. Klik butang Log Masuk untuk akses pentadbir.</div>
                </div>
                <div style="display:flex;gap:8px;align-items:center">
                  <button id="adminOpenLoginBtn" class="btn">Log Masuk (Admin)</button>
                </div>
                <div id="adminLoginMsg" class="small muted" style="margin-left:12px"></div>
              </div>

              <div id="adminControls" style="display:none; margin-top:6px;">
                <div class="admin-controls-row" style="display:flex;gap:10px;align-items:center;margin-bottom:8px;flex-wrap:wrap">
                  <!-- Left group: logout + search + add/update -->
                  <div style="display:flex;gap:8px;align-items:center;flex:1;min-width:260px">
                    <button id="adminLogoutBtn" class="btn-ghost" style="display:none">Log Keluar</button>
                    <input id="unitSearch" placeholder="Cari unit (A-12-03)" style="flex:1;min-width:160px" />
                    <button id="unitAddBtn" class="btn" style="white-space:nowrap">Tambah / Kemas Kini</button>
                  </div>

                  <!-- Right group: CSV actions (file input + preview + import) -->
                  <div class="csv-controls" style="display:flex;gap:8px;align-items:center">
                    <label for="csvFileInput" class="file-input-label btn-ghost" style="display:inline-flex;align-items:center;gap:8px;cursor:pointer;padding:8px 12px;border-radius:8px;border:1px solid var(--input-border);background:var(--surface)">üìÅ <span id="csvFileLabel">Choose File</span></label>
                    <input id="csvFileInput" type="file" accept=".csv" style="display:none" />
                    <button id="csvPreviewBtn" class="btn-ghost" style="white-space:nowrap">Pratonton CSV</button>
                    <button id="csvImportBtn" class="btn" style="white-space:nowrap">Import CSV</button>
                    <button id="csvForceWriteBtn" class="btn" style="white-space:nowrap">Tulis Dari CSV (Force)</button>
                    <!-- Migration controls: preview & apply migration of legacy/misnamed fields -->
                    <button id="migratePreviewBtn" class="btn-ghost" style="white-space:nowrap">Pratonton Migrasi</button>
                    <button id="migrateApplyBtn" class="btn" style="white-space:nowrap">Jalankan Migrasi</button>
                  </div>
                </div>
                <div id="csvPreviewArea" class="card card-tight small" style="display:none;max-height:260px;overflow:auto"></div>
                <div id="migrationPreviewArea" class="card card-tight small" style="display:none;max-height:320px;overflow:auto;margin-top:8px"></div>
                <div id="unitEditArea" style="display:none;margin-top:8px" class="card card-tight">
                  <div style="display:grid;grid-template-columns:1fr 120px;gap:8px;align-items:center">
                    <div>
                      <label>Unit</label>
                      <input id="unitEditId" placeholder="A-12-03" />
                    </div>
                    <div>
                      <label>Arrears</label>
                      <select id="unitEditArrears"><option value="false">Tiada</option><option value="true">Ada</option></select>
                    </div>
                    <div>
                      <label>Kategori</label>
                      <input id="unitEditCategory" placeholder="A / B / C" />
                    </div>
                    <div>
                      <label>Jumlah (RM)</label>
                      <input id="unitEditAmount" placeholder="0" type="number" step="0.01" />
                    </div>
                  </div>
                  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
                    <button id="saveUnitBtn" class="btn">Simpan Unit</button>
                    <button id="cancelUnitBtn" class="btn-ghost">Batal</button>
                  </div>
                </div>

                <div id="unitsListArea" style="margin-top:10px;overflow:auto;max-height:260px" class="card card-tight small"></div>
                <div id="unitRawArea" class="card card-tight small" style="display:none;margin-top:8px;max-height:200px;overflow:auto;"></div>
              </div>
            </div>
          </div>

          <div id="pageUnitContacts" style="display:none; margin-top:12px;">
            <h3 class="page-heading-box" style="margin-top:6px">Senarai Hubungan Unit</h3>
            <div style="margin:6px 0; display:flex; justify-content:flex-end;">
              <input id="unitContactsSearch" type="search" placeholder="Cari unit atau nama penghuni" style="min-width:240px; padding:8px 10px; border-radius:10px; border:1px solid var(--input-border);" aria-label="Cari hubungan unit" />
            </div>
            <div class="card card-tight">
              <div id="listAreaUnitContacts" style="margin-top:8px"></div>
            </div>
          </div>

          <div id="pageWater" style="display:none; margin-top:12px;">
            <h3 class="page-heading-box" style="margin-top:6px">Rekod Harian ‚Äî Bacaan Air</h3>
            <div class="card card-tight" style="max-width:920px;">
              <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;flex-wrap:wrap">
                <label for="waterDate" class="small muted">Tarikh</label>
                <input id="waterDate" type="date" />
                <label class="small muted">Bacaan Jenis 1</label>
                <input id="waterType1" type="number" step="any" />
                <label class="small muted">Bacaan Jenis 2</label>
                <input id="waterType2" type="number" step="any" />
                <button id="waterSaveBtn" class="btn">Simpan</button>
              </div>
              <div id="waterListArea" class="card card-tight small" style="max-height:360px;overflow:auto;margin-top:8px"></div>
            </div>
          </div>

          <!-- Login modal for Admin (shared-password) -->
          <div id="adminLoginModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:12010;">
            <div class="card" style="width:420px;max-width:95%;padding:18px;">
              <button id="adminModalClose" aria-label="Tutup" style="position:absolute;right:14px;top:14px;border:0;background:transparent;font-weight:700;cursor:pointer">√ó</button>
              <h3 style="margin-top:0">Admin Parkir ‚Äî Log Masuk</h3>
              <div class="small muted" style="margin-bottom:8px">Masukkan kata laluan pentadbir untuk akses dan import CSV.</div>
              <label for="adminModalPassword">Password</label>
              <input id="adminModalPassword" type="password" placeholder="Kata laluan admin" />
              <div style="display:flex;gap:8px;margin-top:10px;justify-content:flex-end">
                <button id="adminModalLoginBtn" class="btn">Log Masuk</button>
                <button id="adminModalCancelBtn" class="btn-ghost">Batal</button>
              </div>
              <div id="adminModalMsg" class="small muted" style="margin-top:8px"></div>
            </div>
          </div>

          <!-- Reusable confirmation modal (prettier than native confirm) -->
          <div id="confirmModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:13000;">
            <div class="card" style="width:420px;max-width:95%;padding:18px;position:relative;">
              <button id="confirmModalClose" aria-label="Tutup" style="position:absolute;right:14px;top:14px;border:0;background:transparent;font-weight:700;cursor:pointer">√ó</button>
              <h3 id="confirmModalTitle" style="margin-top:0">Sahkan tindakan</h3>
              <div id="confirmModalMessage" class="small muted" style="margin-top:8px"></div>
              <div style="display:flex;gap:8px;margin-top:14px;justify-content:flex-end">
                <button id="confirmModalCancel" class="btn-ghost">Batal</button>
                <button id="confirmModalConfirm" class="btn">Sahkan</button>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- Edit modal (placed once) -->
  <div id="editModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="editModalLabel" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:12000;">
    <div class="card" style="width:420px;max-width:95%;padding:16px;position:relative;">
      <button id="closeEditModal" aria-label="Tutup" style="position:absolute;right:10px;top:10px;border:0;background:transparent;font-weight:700;cursor:pointer">√ó</button>
      <h3 id="editModalLabel" style="margin-top:0">Isi / Kemas Kini Butiran</h3>

      <form id="editForm">
        <label style="font-weight:700;margin-top:8px">Unit / Tuan Rumah</label>
        <input id="editUnit" name="unit" placeholder="Contoh: A-12-03" />

        <label style="font-weight:700;margin-top:8px">ETA</label>
        <input id="editETA" name="eta" type="date" />

        <label style="font-weight:700;margin-top:8px">ETD</label>
        <input id="editETD" name="etd" type="date" />

        <label style="font-weight:700;margin-top:8px">Kenderaan (nombor / senarai)</label>
        <input id="editVehicle" name="vehicle" placeholder="ABC1234 atau ABC1234;XYZ5678" />

        <label style="font-weight:700;margin-top:8px">Status</label>
        <select id="editStatus" name="status">
          <option value="Pending">Pending</option>
          <option value="Checked In">Checked In</option>
          <option value="Checked Out">Checked Out</option>
        </select>

        <div class="actions" style="justify-content:flex-end;margin-top:12px;">
          <button type="button" id="saveEditBtn" class="btn">Simpan</button>
          <button type="button" id="cancelEditBtn" class="btn-ghost">Batal</button>
        </div>
        <input type="hidden" id="editDocId" />
      </form>
    </div>
  </div>

  <!-- Modal edit slot (satu sahaja dalam halaman) -->
  <div id="parkingSlotModal" class="modal hidden" aria-hidden="true" role="dialog" aria-labelledby="parkingSlotModalLabel" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:12000;">
    <div class="card card-tight" style="width:520px;max-width:95%;">
      <button id="closeParkingModal" aria-label="Tutup" style="position:absolute;right:12px;top:12px;border:0;background:transparent;font-size:20px;cursor:pointer">√ó</button>
      <h3 id="parkingSlotModalLabel" style="margin-top:0">Edit Lot Parkir</h3>
      <form id="parkingSlotForm">
        <div class="form-row grid">
          <label>Lot</label>
          <div><input id="slotNumber" disabled /></div>
        </div>
        <div class="form-row grid">
          <label>Nombor Kenderaan</label>
          <div><input id="slotVehicle" placeholder="Contoh: ABC1234" class="force-mono" /></div>
        </div>
        <div class="form-row grid">
          <label>Unit Rumah</label>
          <div><input id="slotUnit" placeholder="Contoh: B1-1-1" /></div>
        </div>
        <div class="form-row grid">
          <label>ETA</label>
          <div><input id="slotETA" type="date" /></div>
        </div>
        <div class="form-row grid">
          <label>ETD</label>
          <div><input id="slotETD" type="date" /></div>
        </div>

        <div class="form-row">
          <label></label>
          <div style="display:flex;align-items:center;gap:8px">
            <input id="applyToRegistration" type="checkbox" />
            <div class="small">Terapkan perubahan ini ke Pendaftaran (responses)</div>
          </div>
        </div>

        <div class="actions" style="justify-content:flex-end;">
          <button type="button" id="saveSlotBtn" class="btn">Simpan</button>
          <button type="button" id="clearSlotBtn" class="btn-ghost">Kosongkan</button>
          <button type="button" id="cancelSlotBtn" class="btn-ghost">Batal</button>
        </div>
        <input type="hidden" id="slotDocId" />
      </form>
    </div>
  </div>

  <div id="spinner" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.6);z-index:9999;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:24px 32px;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.12);display:flex;flex-direction:column;align-items:center;">
      <div class="loader" style="width:48px;height:48px;border:6px solid #eee;border-top:6px solid var(--accent);border-radius:50%;animation:spin 1s linear infinite;"></div>
      <div style="margin-top:12px;font-weight:600;color:var(--accent)">Memuat data...</div>
    </div>
  </div>
  <script>
    // Spinner animation
    const style = document.createElement('style');
    style.textContent = `@keyframes spin { 0% { transform: rotate(0deg);} 100% {transform: rotate(360deg);} }`;
    document.head.appendChild(style);
  </script>
  <script type="module" src="js/firebase-init.js"></script>
  <!-- Load defaults first, then override with a local config if present -->
  <script src="config.example.js"></script>
  <script src="config.local.js"></script>
  <!-- Static units list used by admin views -->
  <script src="js/units-list.js"></script>
  <script type="module" src="js/dashboard.js"></script>
</body>
</html>
